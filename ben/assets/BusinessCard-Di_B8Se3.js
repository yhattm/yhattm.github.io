import{E as y}from"./Entity-DpinO5cs.js";import{R as i}from"./Result-BKWviScr.js";import{I as b}from"./Identifier-Yjt1Lx6E.js";import{C as p}from"./CardImageId-9m3OyPHK.js";import{V as g}from"./ValueObject-DRESENkS.js";class u extends b{constructor(t){super(t)}static create(){return new u(crypto.randomUUID())}static from(t){return new u(t)}}class m extends g{constructor(t){super(t.toLowerCase())}static create(t){if(!t||t.trim().length===0)return i.fail(new Error("Email address cannot be empty"));const e=t.trim();return m.isValid(e)?i.ok(new m(e)):i.fail(new Error(`Invalid email address: ${e}`))}static isValid(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}get domain(){return this._value.split("@")[1]||""}get localPart(){return this._value.split("@")[0]||""}}class o extends g{constructor(t){super(t)}static create(t){if(!t||t.trim().length===0)return i.fail(new Error("Phone number cannot be empty"));const e=o.normalize(t);return o.isValid(e)?i.ok(new o(e)):i.fail(new Error(`Invalid phone number: ${t}`))}static normalize(t){return t.replace(/[^\d+]/g,"")}static isValid(t){const e=t.replace(/\+/g,"");return!!(/^09\d{8}$/.test(e)||/^0[2-8]\d{7,8}$/.test(e)||/^\+886\d{9,10}$/.test(t))}get formatted(){const t=this._value;return t.startsWith("09")&&t.length===10?t.replace(/(\d{4})(\d{3})(\d{3})/,"$1-$2-$3"):t.startsWith("0")&&t.length===10?t.replace(/(\d{2})(\d{4})(\d{4})/,"$1-$2-$3"):t.startsWith("0")&&t.length===9?t.replace(/(\d{3})(\d{3})(\d{3})/,"$1-$2-$3"):t.startsWith("+886")?t.replace(/(\+886)(\d{1})(\d{4})(\d{4})/,"$1-$2-$3-$4"):t}get isMobile(){return this._value.startsWith("09")||this._value.startsWith("+8869")}get isLandline(){return!this.isMobile&&this._value.startsWith("0")}}class f extends g{constructor(t){super(t)}static create(t){if(!t||t.trim().length===0)return i.fail(new Error("Address cannot be empty"));const e={fullAddress:t.trim()};if(t.trim().split(/\s+/).length>0){const r=t.match(/\b\d{3,5}\b/);r&&(e.postalCode=r[0])}return i.ok(new f(e))}static createDetailed(t){return!t.fullAddress||t.fullAddress.trim().length===0?i.fail(new Error("Full address is required")):i.ok(new f(t))}get formatted(){const t=[];return this._value.street&&t.push(this._value.street),this._value.city&&t.push(this._value.city),this._value.state&&t.push(this._value.state),this._value.postalCode&&t.push(this._value.postalCode),this._value.country&&t.push(this._value.country),t.length>0?t.join(", "):this._value.fullAddress}get fullAddress(){return this._value.fullAddress}get postalCode(){return this._value.postalCode}get hasDetailedComponents(){return!!(this._value.street||this._value.city||this._value.state||this._value.postalCode||this._value.country)}}class l extends g{constructor(t){super(t)}static create(t){if(!t||t.trim().length===0)return i.fail(new Error("Website URL cannot be empty"));const e=t.trim(),a=l.normalize(e);return l.isValid(a)?i.ok(new l(a)):i.fail(new Error(`Invalid website URL: ${t}`))}static normalize(t){return/^https?:\/\//i.test(t)?t:`https://${t}`}static isValid(t){try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}}get domain(){try{return new URL(this._value).hostname}catch{return""}}get displayUrl(){return this._value.replace(/^https?:\/\//,"")}}class d{constructor(t,e,a,r,n,s,h,w,I){this._name=t,this._title=e,this._company=a,this._phone=r,this._email=n,this._address=s,this._website=h,this._socialMedia=w,this._fax=I}static create(t){let e;if(t.phone){const s=o.create(t.phone);if(s.isFailure)return i.fail(s.error);e=s.value}let a;if(t.email){const s=m.create(t.email);if(s.isFailure)return i.fail(s.error);a=s.value}let r;if(t.address){const s=f.create(t.address);s.isFailure?r=void 0:r=s.value}let n;if(t.website){const s=l.create(t.website);s.isFailure?n=void 0:n=s.value}return i.ok(new d(t.name?.trim(),t.title?.trim(),t.company?.trim(),e,a,r,n,t.socialMedia?.trim(),t.fax?.trim()))}update(t){const e={name:t.name!==void 0?t.name:this._name,title:t.title!==void 0?t.title:this._title,company:t.company!==void 0?t.company:this._company,phone:t.phone!==void 0?t.phone:this._phone?.value,email:t.email!==void 0?t.email:this._email?.value,address:t.address!==void 0?t.address:this._address?.fullAddress,website:t.website!==void 0?t.website:this._website?.value,socialMedia:t.socialMedia!==void 0?t.socialMedia:this._socialMedia,fax:t.fax!==void 0?t.fax:this._fax};return d.create(e)}hasMinimumInfo(){return!!(this._name||this._company||this._email||this._phone)}isComplete(){return!!(this._name&&this._company&&(this._email||this._phone))}get name(){return this._name}get title(){return this._title}get company(){return this._company}get phone(){return this._phone}get email(){return this._email}get address(){return this._address}get website(){return this._website}get socialMedia(){return this._socialMedia}get fax(){return this._fax}toPlainObject(){return{name:this._name,title:this._title,company:this._company,phone:this._phone?.value,email:this._email?.value,address:this._address?.fullAddress,website:this._website?.value,socialMedia:this._socialMedia,fax:this._fax}}}class c{constructor(t,e,a=1){this.createdAt=t,this.lastModified=e,this.scanCount=a}static initial(){const t=new Date;return new c(t,t,1)}static from(t,e,a){return new c(t,e,a)}markAsModified(){return new c(this.createdAt,new Date,this.scanCount)}markAsRescanned(){return new c(this.createdAt,new Date,this.scanCount+1)}get timestamp(){return this.createdAt.getTime()}get lastModifiedTimestamp(){return this.lastModified.getTime()}}class _{constructor(t,e){if(this.rawText=t,this.confidence=e,e<0||e>100)throw new Error("Confidence must be between 0 and 100")}static create(t,e){return new _(t,e)}hasValidImage(){return this.rawText.trim().length>0}isHighConfidence(){return this.confidence>=70}isLowConfidence(){return this.confidence<50}get confidenceLevel(){return this.confidence>=70?"high":this.confidence>=50?"medium":"low"}}class v extends y{constructor(t,e,a,r,n){super(t,n.createdAt,n.lastModified),this._imageId=e,this._contactInfo=a,this._scanData=r,this._metadata=n}static create(t){const e=t.id||u.create(),a=d.create(t.contactInfo);if(a.isFailure)return i.fail(a.error);const r=_.create(t.scanData.rawText,t.scanData.confidence),n=t.metadata||c.initial(),s=new v(e,t.imageId,a.value,r,n),h=s.validate();return h.isFailure?i.fail(h.error):i.ok(s)}static from(t,e,a,r,n){return v.create({id:u.from(t),imageId:p.from(e),contactInfo:a,scanData:r,metadata:c.from(n.createdAt,n.lastModified,n.scanCount)})}updateContactInfo(t){const e=this._contactInfo.update(t);return e.isFailure?i.fail(e.error):(this._contactInfo=e.value,this._metadata=this._metadata.markAsModified(),this.markAsUpdated(),i.ok(void 0))}rescan(t,e,a){this._scanData=_.create(t,e);const r=d.create(a);return r.isFailure?i.fail(r.error):(this._contactInfo=r.value,this._metadata=this._metadata.markAsRescanned(),this.markAsUpdated(),i.ok(void 0))}validate(){return this._scanData.hasValidImage()?this._contactInfo.hasMinimumInfo()?i.ok(void 0):i.fail(new Error("Card must have at least name, company, email, or phone number")):i.fail(new Error("Card must have valid OCR scan data"))}get imageId(){return this._imageId}get contactInfo(){return this._contactInfo}get scanData(){return this._scanData}get metadata(){return this._metadata}get name(){return this._contactInfo.name}get company(){return this._contactInfo.company}get email(){return this._contactInfo.email?.value}get phone(){return this._contactInfo.phone?.value}get title(){return this._contactInfo.title}get address(){return this._contactInfo.address?.fullAddress}get website(){return this._contactInfo.website?.value}get isComplete(){return this._contactInfo.isComplete()}get timestamp(){return this._metadata.timestamp}get lastModified(){return this._metadata.lastModifiedTimestamp}get scanCount(){return this._metadata.scanCount}get rawOcr(){return this._scanData.rawText}get confidence(){return this._scanData.confidence}}export{v as B,u as a};
