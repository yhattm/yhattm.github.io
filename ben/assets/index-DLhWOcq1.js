var te={exports:{}},Oe;function Ve(){return Oe||(Oe=1,(function(u){var t=(function(e){var r=Object.prototype,s=r.hasOwnProperty,i=Object.defineProperty||function(a,n,c){a[n]=c.value},d,g=typeof Symbol=="function"?Symbol:{},k=g.iterator||"@@iterator",L=g.asyncIterator||"@@asyncIterator",b=g.toStringTag||"@@toStringTag";function O(a,n,c){return Object.defineProperty(a,n,{value:c,enumerable:!0,configurable:!0,writable:!0}),a[n]}try{O({},"")}catch{O=function(n,c,m){return n[c]=m}}function C(a,n,c,m){var h=n&&n.prototype instanceof S?n:S,T=Object.create(h.prototype),x=new Y(m||[]);return i(T,"_invoke",{value:X(a,c,x)}),T}e.wrap=C;function A(a,n,c){try{return{type:"normal",arg:a.call(n,c)}}catch(m){return{type:"throw",arg:m}}}var E="suspendedStart",f="suspendedYield",o="executing",l="completed",v={};function S(){}function p(){}function M(){}var _={};O(_,k,function(){return this});var z=Object.getPrototypeOf,G=z&&z(z(J([])));G&&G!==r&&s.call(G,k)&&(_=G);var j=M.prototype=S.prototype=Object.create(_);p.prototype=M,i(j,"constructor",{value:M,configurable:!0}),i(M,"constructor",{value:p,configurable:!0}),p.displayName=O(M,b,"GeneratorFunction");function K(a){["next","throw","return"].forEach(function(n){O(a,n,function(c){return this._invoke(n,c)})})}e.isGeneratorFunction=function(a){var n=typeof a=="function"&&a.constructor;return n?n===p||(n.displayName||n.name)==="GeneratorFunction":!1},e.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,M):(a.__proto__=M,O(a,b,"GeneratorFunction")),a.prototype=Object.create(j),a},e.awrap=function(a){return{__await:a}};function W(a,n){function c(T,x,N,P){var q=A(a[T],a,x);if(q.type==="throw")P(q.arg);else{var y=q.arg,R=y.value;return R&&typeof R=="object"&&s.call(R,"__await")?n.resolve(R.__await).then(function(I){c("next",I,N,P)},function(I){c("throw",I,N,P)}):n.resolve(R).then(function(I){y.value=I,N(y)},function(I){return c("throw",I,N,P)})}}var m;function h(T,x){function N(){return new n(function(P,q){c(T,x,P,q)})}return m=m?m.then(N,N):N()}i(this,"_invoke",{value:h})}K(W.prototype),O(W.prototype,L,function(){return this}),e.AsyncIterator=W,e.async=function(a,n,c,m,h){h===void 0&&(h=Promise);var T=new W(C(a,n,c,m),h);return e.isGeneratorFunction(n)?T:T.next().then(function(x){return x.done?x.value:T.next()})};function X(a,n,c){var m=E;return function(T,x){if(m===o)throw new Error("Generator is already running");if(m===l){if(T==="throw")throw x;return V()}for(c.method=T,c.arg=x;;){var N=c.delegate;if(N){var P=B(N,c);if(P){if(P===v)continue;return P}}if(c.method==="next")c.sent=c._sent=c.arg;else if(c.method==="throw"){if(m===E)throw m=l,c.arg;c.dispatchException(c.arg)}else c.method==="return"&&c.abrupt("return",c.arg);m=o;var q=A(a,n,c);if(q.type==="normal"){if(m=c.done?l:f,q.arg===v)continue;return{value:q.arg,done:c.done}}else q.type==="throw"&&(m=l,c.method="throw",c.arg=q.arg)}}}function B(a,n){var c=n.method,m=a.iterator[c];if(m===d)return n.delegate=null,c==="throw"&&a.iterator.return&&(n.method="return",n.arg=d,B(a,n),n.method==="throw")||c!=="return"&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+c+"' method")),v;var h=A(m,a.iterator,n.arg);if(h.type==="throw")return n.method="throw",n.arg=h.arg,n.delegate=null,v;var T=h.arg;if(!T)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;if(T.done)n[a.resultName]=T.value,n.next=a.nextLoc,n.method!=="return"&&(n.method="next",n.arg=d);else return T;return n.delegate=null,v}K(j),O(j,b,"Generator"),O(j,k,function(){return this}),O(j,"toString",function(){return"[object Generator]"});function $(a){var n={tryLoc:a[0]};1 in a&&(n.catchLoc=a[1]),2 in a&&(n.finallyLoc=a[2],n.afterLoc=a[3]),this.tryEntries.push(n)}function H(a){var n=a.completion||{};n.type="normal",delete n.arg,a.completion=n}function Y(a){this.tryEntries=[{tryLoc:"root"}],a.forEach($,this),this.reset(!0)}e.keys=function(a){var n=Object(a),c=[];for(var m in n)c.push(m);return c.reverse(),function h(){for(;c.length;){var T=c.pop();if(T in n)return h.value=T,h.done=!1,h}return h.done=!0,h}};function J(a){if(a){var n=a[k];if(n)return n.call(a);if(typeof a.next=="function")return a;if(!isNaN(a.length)){var c=-1,m=function h(){for(;++c<a.length;)if(s.call(a,c))return h.value=a[c],h.done=!1,h;return h.value=d,h.done=!0,h};return m.next=m}}return{next:V}}e.values=J;function V(){return{value:d,done:!0}}return Y.prototype={constructor:Y,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(H),!a)for(var n in this)n.charAt(0)==="t"&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=d)},stop:function(){this.done=!0;var a=this.tryEntries[0],n=a.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(a){if(this.done)throw a;var n=this;function c(P,q){return T.type="throw",T.arg=a,n.next=P,q&&(n.method="next",n.arg=d),!!q}for(var m=this.tryEntries.length-1;m>=0;--m){var h=this.tryEntries[m],T=h.completion;if(h.tryLoc==="root")return c("end");if(h.tryLoc<=this.prev){var x=s.call(h,"catchLoc"),N=s.call(h,"finallyLoc");if(x&&N){if(this.prev<h.catchLoc)return c(h.catchLoc,!0);if(this.prev<h.finallyLoc)return c(h.finallyLoc)}else if(x){if(this.prev<h.catchLoc)return c(h.catchLoc,!0)}else if(N){if(this.prev<h.finallyLoc)return c(h.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(a,n){for(var c=this.tryEntries.length-1;c>=0;--c){var m=this.tryEntries[c];if(m.tryLoc<=this.prev&&s.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var h=m;break}}h&&(a==="break"||a==="continue")&&h.tryLoc<=n&&n<=h.finallyLoc&&(h=null);var T=h?h.completion:{};return T.type=a,T.arg=n,h?(this.method="next",this.next=h.finallyLoc,v):this.complete(T)},complete:function(a,n){if(a.type==="throw")throw a.arg;return a.type==="break"||a.type==="continue"?this.next=a.arg:a.type==="return"?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):a.type==="normal"&&n&&(this.next=n),v},finish:function(a){for(var n=this.tryEntries.length-1;n>=0;--n){var c=this.tryEntries[n];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),H(c),v}},catch:function(a){for(var n=this.tryEntries.length-1;n>=0;--n){var c=this.tryEntries[n];if(c.tryLoc===a){var m=c.completion;if(m.type==="throw"){var h=m.arg;H(c)}return h}}throw new Error("illegal catch attempt")},delegateYield:function(a,n,c){return this.delegate={iterator:J(a),resultName:n,nextLoc:c},this.method==="next"&&(this.arg=d),v}},e})(u.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(te)),te.exports}var re,Ee;function Le(){return Ee||(Ee=1,re=(u,t)=>`${u}-${t}-${Math.random().toString(16).slice(3,8)}`),re}var ne,ke;function He(){if(ke)return ne;ke=1;const u=Le();let t=0;return ne=({id:e,action:r,payload:s={}})=>{let i=e;return typeof i>"u"&&(i=u("Job",t),t+=1),{id:i,action:r,payload:s}},ne}var Z={},Se;function be(){if(Se)return Z;Se=1;let u=!1;return Z.logging=u,Z.setLogging=t=>{u=t},Z.log=(...t)=>u?console.log.apply(this,t):null,Z}var oe,Te;function Qe(){if(Te)return oe;Te=1;const u=He(),{log:t}=be(),e=Le();let r=0;return oe=()=>{const s=e("Scheduler",r),i={},d={};let g=[];r+=1;const k=()=>g.length,L=()=>Object.keys(i).length,b=()=>{if(g.length!==0){const f=Object.keys(i);for(let o=0;o<f.length;o+=1)if(typeof d[f[o]]>"u"){g[0](i[f[o]]);break}}},O=(f,o)=>new Promise((l,v)=>{const S=u({action:f,payload:o});g.push(async p=>{g.shift(),d[p.id]=S;try{l(await p[f].apply(this,[...o,S.id]))}catch(M){v(M)}finally{delete d[p.id],b()}}),t(`[${s}]: Add ${S.id} to JobQueue`),t(`[${s}]: JobQueue length=${g.length}`),b()});return{addWorker:f=>(i[f.id]=f,t(`[${s}]: Add ${f.id}`),t(`[${s}]: Number of workers=${L()}`),b(),f.id),addJob:async(f,...o)=>{if(L()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return O(f,o)},terminate:async()=>{Object.keys(i).forEach(async f=>{await i[f].terminate()}),g=[]},getQueueLen:k,getNumWorkers:L}},oe}function Xe(u){throw new Error('Could not dynamically require "'+u+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ae,Ce;function et(){return Ce||(Ce=1,ae=u=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Xe=="function"&&(t.type="node"),typeof u>"u"?t:t[u]}),ae}var ie,Ae;function tt(){if(Ae)return ie;Ae=1;const t=et()("type")==="browser"?e=>new URL(e,window.location.href).href:e=>e;return ie=e=>{const r={...e};return["corePath","workerPath","langPath"].forEach(s=>{e[s]&&(r[s]=t(r[s]))}),r},ie}var se,Me;function Ye(){return Me||(Me=1,se={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),se}const rt="6.0.1",nt={version:rt};var ce,Ie;function ot(){return Ie||(Ie=1,ce={workerBlobURL:!0,logger:()=>{}}),ce}var le,_e;function at(){if(_e)return le;_e=1;const u=nt.version;return le={...ot(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${u}/dist/worker.min.js`},le}var ue,xe;function it(){return xe||(xe=1,ue=({workerPath:u,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){const r=new Blob([`importScripts("${u}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(r))}else e=new Worker(u);return e}),ue}var de,Ne;function st(){return Ne||(Ne=1,de=u=>{u.terminate()}),de}var fe,qe;function ct(){return qe||(qe=1,fe=(u,t)=>{u.onmessage=({data:e})=>{t(e)}}),fe}var he,Pe;function lt(){return Pe||(Pe=1,he=async(u,t)=>{u.postMessage(t)}),he}var ge,$e;function ut(){if($e)return ge;$e=1;const u=e=>new Promise((r,s)=>{const i=new FileReader;i.onload=()=>{r(i.result)},i.onerror=({target:{error:{code:d}}})=>{s(Error(`File could not be read! Code=${d}`))},i.readAsArrayBuffer(e)}),t=async e=>{let r=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?r=atob(e.split(",")[1]).split("").map(s=>s.charCodeAt(0)):r=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(r=await t(e.src)),e.tagName==="VIDEO"&&(r=await t(e.poster)),e.tagName==="CANVAS"&&await new Promise(s=>{e.toBlob(async i=>{r=await u(i),s()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const s=await e.convertToBlob();r=await u(s)}else(e instanceof File||e instanceof Blob)&&(r=await u(e));return new Uint8Array(r)};return ge=t,ge}var pe,De;function dt(){if(De)return pe;De=1;const u=at(),t=it(),e=st(),r=ct(),s=lt(),i=ut();return pe={defaultOptions:u,spawnWorker:t,terminateWorker:e,onMessage:r,send:s,loadImage:i},pe}var me,Ue;function Je(){if(Ue)return me;Ue=1;const u=tt(),t=He(),{log:e}=be(),r=Le(),s=Ye(),{defaultOptions:i,spawnWorker:d,terminateWorker:g,onMessage:k,loadImage:L,send:b}=dt();let O=0;return me=async(C="eng",A=s.LSTM_ONLY,E={},f={})=>{const o=r("Worker",O),{logger:l,errorHandler:v,...S}=u({...i,...E}),p={},M=typeof C=="string"?C.split("+"):C;let _=A,z=f;const G=[s.DEFAULT,s.LSTM_ONLY].includes(A)&&!S.legacyCore;let j,K;const W=new Promise((y,R)=>{K=y,j=R}),X=y=>{j(y.message)};let B=d(S);B.onerror=X,O+=1;const $=({id:y,action:R,payload:I})=>new Promise((D,U)=>{e(`[${o}]: Start ${y}, action=${R}`);const F=`${R}-${y}`;p[F]={resolve:D,reject:U},b(B,{workerId:o,jobId:y,action:R,payload:I})}),H=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Y=y=>$(t({id:y,action:"load",payload:{options:{lstmOnly:G,corePath:S.corePath,logging:S.logging}}})),J=(y,R,I)=>$(t({id:I,action:"FS",payload:{method:"writeFile",args:[y,R]}})),V=(y,R)=>$(t({id:R,action:"FS",payload:{method:"readFile",args:[y,{encoding:"utf8"}]}})),a=(y,R)=>$(t({id:R,action:"FS",payload:{method:"unlink",args:[y]}})),n=(y,R,I)=>$(t({id:I,action:"FS",payload:{method:y,args:R}})),c=(y,R)=>$(t({id:R,action:"loadLanguage",payload:{langs:y,options:{langPath:S.langPath,dataPath:S.dataPath,cachePath:S.cachePath,cacheMethod:S.cacheMethod,gzip:S.gzip,lstmOnly:[s.DEFAULT,s.LSTM_ONLY].includes(_)&&!S.legacyLang}}})),m=(y,R,I,D)=>$(t({id:D,action:"initialize",payload:{langs:y,oem:R,config:I}})),h=(y="eng",R,I,D)=>{if(G&&[s.TESSERACT_ONLY,s.TESSERACT_LSTM_COMBINED].includes(R))throw Error("Legacy model requested but code missing.");const U=R||_;_=U;const F=I||z;z=F;const ee=(typeof y=="string"?y.split("+"):y).filter(Ze=>!M.includes(Ze));return M.push(...ee),ee.length>0?c(ee,D).then(()=>m(y,U,F,D)):m(y,U,F,D)},T=(y={},R)=>$(t({id:R,action:"setParameters",payload:{params:y}})),x=async(y,R={},I={text:!0},D)=>$(t({id:D,action:"recognize",payload:{image:await L(y),options:R,output:I}})),N=async(y,R)=>{if(G)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return $(t({id:R,action:"detect",payload:{image:await L(y)}}))},P=async()=>(B!==null&&(g(B),B=null),Promise.resolve());k(B,({workerId:y,jobId:R,status:I,action:D,data:U})=>{const F=`${D}-${R}`;if(I==="resolve")e(`[${y}]: Complete ${R}`),p[F].resolve({jobId:R,data:U}),delete p[F];else if(I==="reject")if(p[F].reject(U),delete p[F],D==="load"&&j(U),v)v(U);else throw Error(U);else I==="progress"&&l({...U,userJobId:R})});const q={id:o,worker:B,load:H,writeText:J,readText:V,removeFile:a,FS:n,reinitialize:h,setParameters:T,recognize:x,detect:N,terminate:P};return Y().then(()=>c(C)).then(()=>m(C,A,f)).then(()=>K(q)).catch(()=>{}),W},me}var we,ze;function ft(){if(ze)return we;ze=1;const u=Je();return we={recognize:async(r,s,i)=>{const d=await u(s,1,i);return d.recognize(r).finally(async()=>{await d.terminate()})},detect:async(r,s)=>{const i=await u("osd",0,s);return i.detect(r).finally(async()=>{await i.terminate()})}},we}var ve,Ge;function ht(){return Ge||(Ge=1,ve={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),ve}var ye,je;function gt(){return je||(je=1,ye={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),ye}var Re,Be;function pt(){if(Be)return Re;Be=1,Ve();const u=Qe(),t=Je(),e=ft(),r=ht(),s=Ye(),i=gt(),{setLogging:d}=be();return Re={languages:r,OEM:s,PSM:i,createScheduler:u,createWorker:t,setLogging:d,...e},Re}var Fe=pt();const w={email:/[\w.+-]+@[\w.-]+\.[a-zA-Z]{2,}/gi,phone:/(\+?886[-.\s])?\(?0?\d{2,4}\)?[-.\s]?\d{3,4}[-.\s]?\d{3,4}|(\+?\d{1,3}[-.\s])?\(?\d{2,4}\)?[-.\s]\d{3,4}[-.\s]\d{3,4}|\d{2,4}-\d{3,4}-\d{3,4}|\b\d{10}\b/g,url:/https?:\/\/[\w.-]+\.[\w]{2,}(\/[^\s]*)?/gi,linkedin:/linkedin\.com\/in\/[\w-]+/gi,twitter:/twitter\.com\/[\w]+/gi,facebook:/facebook\.com\/[\w.]+/gi,fax:/(?:fax|ÂÇ≥Áúü)[:Ôºö]?\s*(\+?\d{1,3}[-.\s]?)?\(?\d{2,4}\)?[-.\s]?\d{3,4}[-.\s]?\d{3,4}/gi,chineseTitle:/^(Ëë£‰∫ãÈï∑|Á∏ΩÁ∂ìÁêÜ|Âü∑Ë°åÈï∑|ÂâØÁ∏ΩÁ∂ìÁêÜ|ÂâØÁ∏ΩË£Å|Á∏ΩË£Å|Á∂ìÁêÜ|‰∏ª‰ªª|ÈÉ®Èï∑|Ë™≤Èï∑|ÁµÑÈï∑|Â∞àÂì°|‰∏ªÁÆ°|È°ßÂïè|Á∏ΩÁõ£)$/,titleKeywords:/(Ëë£‰∫ãÈï∑|Á∏ΩÁ∂ìÁêÜ|Âü∑Ë°åÈï∑|ÂâØÁ∏Ω|Á∏ΩË£Å|Á∂ìÁêÜ|‰∏ª‰ªª|ÈÉ®Èï∑|Ë™≤Èï∑|ÁµÑÈï∑|Â∞àÂì°|‰∏ªÁÆ°|È°ßÂïè|Á∏ΩÁõ£|.*Èï∑)$/,taxId:/(?:Áµ±Á∑®|Áµ±‰∏ÄÁ∑®Ëôü|Tax\s*ID)[:Ôºö]?\s*(\d{8})/gi,addressKeywords:/(?:Âú∞ÂùÄ|ÂùÄ|address|Â±ïÁ§∫È§®|Ëæ¶ÂÖ¨ÂÆ§|office)[:Ôºö]?\s*/gi,garbageChars:/[^\u4e00-\u9fff\w\s@.+\-()\/,;:Ôºö"]/g,repeatingChars:/(.)\1{4,}/g,excessiveSpaces:/\s{3,}/g};function mt(u){if(!u||u.length===0)return 0;let t=100;const e=(u.match(w.garbageChars)||[]).length;t-=e*5,w.repeatingChars.test(u)&&(t-=30),w.excessiveSpaces.test(u)&&(t-=20),u.length<2&&(t-=50),(u.match(/\d/g)||[]).length/u.length>.8&&!w.phone.test(u)&&(t-=20);const i=(u.match(/[\u4e00-\u9fff]/g)||[]).length;return i>0&&(t+=Math.min(i*2,20)),(w.email.test(u)||w.phone.test(u)||w.url.test(u))&&(t+=20),Math.max(0,Math.min(100,t))}function wt(u){let t=u;return t=t.replace(w.garbageChars,""),t=t.replace(w.excessiveSpaces," "),t=t.replace(/([^a-zA-Z0-9\u4e00-\u9fff])\1{2,}/g,"$1$1"),t.trim()}function vt(u){return u.map(t=>wt(t)).filter(t=>t.length===0?!1:mt(t)>=40)}function We(u){let t=u.replace(/[oO]/g,"0").replace(/[lI]/g,"1").replace(/[zZ]/g,"2").replace(/[sS]/g,"5");return t=t.replace(/[^\d\-+().\s]/g,""),t.trim()}function Ke(u){const t=u.split(`
`).map(o=>o.trim()).filter(o=>o.length>0),e=vt(t),r={},s=/(inc\.|ltd\.|corp\.|limited|company|ÂÖ¨Âè∏|ÊúâÈôêÂÖ¨Âè∏|ËÇ°‰ªΩ|ÈõÜÂúò|‰ºÅÊ•≠)/i;if(e.length===1&&e[0]&&s.test(e[0]))return r.company=Q(e[0]),r;if(e.length===2&&e[0]&&e[1]&&s.test(e[0])&&/(?:Â∏Ç|ÂçÄ|Ë∑Ø|Ë°ó|Â∑∑|ÂºÑ|Ëôü|Ê®ì|street|road|avenue|floor)/i.test(e[1]))return r.company=Q(e[0]),r.address=e[1],r;const i=e.join(`
`),d=i.match(w.email);d&&d.length>0&&(r.email=d[0]);const g=i.match(w.phone);if(g&&g.length>0){const o=g.filter(l=>{const v=i.indexOf(l),S=i.substring(Math.max(0,v-10),v);if(/(fax|ÂÇ≥Áúü)/i.test(S))return!1;const p=i[v-1]||"",M=i[v+l.length]||"";return!(/\d/.test(p)||/\d/.test(M))});o.length>0&&o[0]&&(r.phone=We(o[0]))}const k=i.match(w.fax);if(k&&k.length>0){const o=k[0].replace(/(?:fax|ÂÇ≥Áúü)[:Ôºö]?\s*/gi,"").trim();r.fax=We(o)}const L=i.match(w.url);L&&L.length>0&&(r.website=L[0]);const b=[...i.match(w.linkedin)||[],...i.match(w.twitter)||[],...i.match(w.facebook)||[]];b.length>0&&(r.socialMedia=b.join(", "));const O=i.match(w.taxId);O&&O.length>0&&O[0].match(/\d{8}/);let C=!1;for(let o=0;o<Math.min(e.length,10);o++){const l=e[o];if(!l)continue;const v=/[\u4e00-\u9fff]/.test(l),S=/[A-Za-z]{2,}/.test(l);if(!(w.email.test(l)||w.phone.test(l)||w.url.test(l)||s.test(l))&&v&&S&&l.length<50){r.name=l,C=!0;break}}if(!C&&e.length>0&&e[0]){const o=e[0];o.length>3&&o.length<80&&!w.email.test(o)&&!w.phone.test(o)&&(r.name=o)}let A=!1;for(let o=0;o<Math.min(e.length,8);o++){const l=e[o];if(!l||r.name&&l===r.name||w.email.test(l)||w.phone.test(l)||w.url.test(l)||s.test(l))continue;const v=l.replace(/^[A-Za-z0-9]\s+/,"").trim();if(w.chineseTitle.test(v)){r.title=v,A=!0;break}if(w.titleKeywords.test(v)&&v.length<20){r.title=v,A=!0;break}}if(!A&&e.length>1&&e[1]){const o=e[1];o!==r.name&&o.length<60&&!w.email.test(o)&&!w.phone.test(o)&&!w.url.test(o)&&(r.title=o)}const E=e.find(o=>s.test(o));if(E&&E.length<100)r.company=Q(E);else for(let o=2;o<Math.min(e.length,6);o++){const l=e[o];if(l&&l.length>2&&l.length<100&&!w.email.test(l)&&!w.phone.test(l)&&!w.url.test(l)&&!w.chineseTitle.test(l.trim())&&l!==r.name&&l!==r.title&&(s.test(l)||l.length<50&&o<=3)){r.company=Q(l);break}}const f=e.filter(o=>{const l=/(?:Âú∞ÂùÄ|ÂùÄ|address|Â±ïÁ§∫È§®|Ëæ¶ÂÖ¨ÂÆ§|office)[:Ôºö]/i.test(o),v=/(?:Â∏Ç|ÂçÄ|Ë∑Ø|Ë°ó|Â∑∑|ÂºÑ|Ëôü|Ê®ì|street|road|avenue|floor)/i.test(o);return(l||v)&&o.length>10&&o.length<200&&!w.email.test(o)&&!w.phone.test(o)&&!w.url.test(o)&&o!==r.name&&o!==r.title&&o!==r.company});if(f.length>0){const o=f.map(l=>l.replace(w.addressKeywords,"").replace(/^[\/\\]+\s*/,"").trim());r.address=o[0]}else{const o=e.find(l=>l.length>20&&l.length<200&&!w.email.test(l)&&!w.phone.test(l)&&!w.url.test(l)&&l!==r.name&&l!==r.title&&l!==r.company);o&&(r.address=o.replace(/^[\/\\]+\s*/,"").trim())}return r}function Q(u){let t=u.trim();return t=t.replace(/^[\d\s\-_.,:;!?@#$%^&*()[\]{}|\\/<>~`'"]+/,""),t=t.replace(/^[A-Za-z]\s+/,""),t.trim()}class Rt{worker=null;initialized=!1;version="v3.0.0";async init(){if(!(this.initialized&&this.worker)){console.log(`üîç Tesseract OCR Adapter initializing... Version: ${this.version}`);try{this.worker=await Fe.createWorker("chi_tra+eng",1,{errorHandler:t=>console.error("Tesseract error:",t),logger:t=>{t.status==="recognizing text"&&console.log(`OCR Progress: ${Math.round(t.progress*100)}%`)}}),await this.worker.setParameters({tessedit_pageseg_mode:Fe.PSM.SINGLE_BLOCK,preserve_interword_spaces:"1"}),this.initialized=!0,console.log("‚úÖ Tesseract OCR Adapter initialized successfully")}catch(t){throw console.error("Failed to initialize Tesseract worker:",t),new Error("OCR service initialization failed")}}}async isReady(){try{return await this.init(),this.initialized}catch{return!1}}async recognize(t,e){if(await this.init(),!this.worker)throw new Error("OCR worker not initialized");try{const r=await this.preprocessImage(t),s=await this.worker.recognize(r);e&&e(100);const i=s.data.text,d=s.data.confidence;console.log(`üìä Tesseract Adapter ${this.version} - Confidence: ${d}%`),console.log("OCR Raw Text:",i);const g=Ke(i);return{text:i,confidence:d,extractedData:g}}catch(r){throw console.error("OCR recognition failed:",r),new Error("Failed to process image with OCR")}}async preprocessImage(t){return new Promise((e,r)=>{const s=new Image,i=URL.createObjectURL(t);s.onload=()=>{try{const d=document.createElement("canvas"),g=d.getContext("2d");if(!g){r(new Error("Could not get canvas context"));return}const k=2;d.width=s.width*k,d.height=s.height*k,g.drawImage(s,0,0,d.width,d.height);const L=g.getImageData(0,0,d.width,d.height),b=L.data,O=new Uint8Array(b.length/4);for(let p=0,M=0;p<b.length;p+=4,M++){const _=b[p]??0,z=b[p+1]??0,G=b[p+2]??0;O[M]=Math.round(.299*_+.587*z+.114*G)}const C=new Array(256).fill(0);O.forEach(p=>C[p]++);const A=O.length;let E=0;for(let p=0;p<256;p++)E+=p*C[p];let f=0,o=0,l=0,v=0,S=128;for(let p=0;p<256;p++){if(o+=C[p],o===0)continue;if(l=A-o,l===0)break;f+=p*C[p];const M=f/o,_=(E-f)/l,z=o*l*(M-_)*(M-_);z>v&&(v=z,S=p)}S=Math.min(S+20,255);for(let p=0,M=0;p<b.length;p+=4,M++){const _=(O[M]??0)>S?255:0;b[p]=_,b[p+1]=_,b[p+2]=_}g.putImageData(L,0,0),URL.revokeObjectURL(i),e(d)}catch(d){URL.revokeObjectURL(i),r(d)}},s.onerror=()=>{URL.revokeObjectURL(i),r(new Error("Failed to load image for preprocessing"))},s.src=i})}async detectRegions(t){const e=await this.loadImageToCanvas(t),r=e.getContext("2d");if(!r)throw new Error("Could not get canvas context");const s=e.width,i=e.height,g=r.getImageData(0,0,s,i).data,k=new Uint8Array(s*i);for(let E=0,f=0;E<g.length;E+=4,f++){const o=g[E]??0,l=g[E+1]??0,v=g[E+2]??0;k[f]=Math.round(.299*o+.587*l+.114*v)}const L=8,b=Math.floor(s/L),O=Math.floor(i/L),C=[];for(let E=0;E<L;E++){C[E]=[];for(let f=0;f<L;f++){let o=255,l=0;for(let S=E*O;S<(E+1)*O;S++)for(let p=f*b;p<(f+1)*b;p++){const M=S*s+p,_=k[M]??0;o=Math.min(o,_),l=Math.max(l,_)}const v=l-o;C[E][f]=v}}const A=[];A.push({id:"top",x:0,y:0,width:1,height:.33,label:"Top Region"},{id:"middle",x:0,y:.33,width:1,height:.34,label:"Middle Region"},{id:"bottom",x:0,y:.67,width:1,height:.33,label:"Bottom Region"});for(let E=0;E<L;E++)for(let f=0;f<L;f++)C[E]?.[f];return console.log(`üîç Detected ${A.length} regions for OCR processing`),A}async recognizeRegion(t,e,r){if(await this.init(),!this.worker)throw new Error("OCR worker not initialized");try{const s=await this.cropImageToRegion(t,e),i=await this.preprocessImage(s),d=await this.worker.recognize(i);r&&r(100);const g=d.data.text,k=d.data.confidence;console.log(`üìä Region ${e.id} - Confidence: ${k}% - Text: ${g.substring(0,50)}`);const L=Ke(g);return{region:e,text:g,confidence:k,extractedData:L}}catch(s){throw console.error(`OCR recognition failed for region ${e.id}:`,s),new Error(`Failed to process region ${e.id} with OCR`)}}async recognizeWithRegions(t,e={},r){const{autoDetectRegions:s=!0,predefinedRegions:i,minConfidence:d=50,enableAutoRetry:g=!0}=e,k=await this.recognize(t,f=>{r&&r(f*.3)});if(console.log(`üîç Full-image OCR confidence: ${k.confidence}%`),k.confidence>=d&&!g)return k;let L;i&&i.length>0?L=i:s?L=await this.detectRegions(t):L=[{id:"top",x:0,y:0,width:1,height:.33,label:"Top"},{id:"middle",x:0,y:.33,width:1,height:.34,label:"Middle"},{id:"bottom",x:0,y:.67,width:1,height:.33,label:"Bottom"}],console.log(`üîç Processing ${L.length} regions for OCR`);const b=[],O=.7/L.length;for(let f=0;f<L.length;f++){const o=L[f];if(o)try{const l=await this.recognizeRegion(t,o,v=>{if(r){const S=.3+f*O+v/100*O;r(S*100)}});b.push(l)}catch(l){console.warn(`Failed to process region ${o.id}:`,l)}}const C=this.mergeRegionResults(b),A=b.reduce((f,o)=>f+o.confidence,0)/b.length;console.log(`üìä Region-based OCR - Average confidence: ${A}%`),console.log(`üìä Merged ${b.length} regions - Full: ${k.confidence}% vs Regions: ${A}%`);const E=A>k.confidence+10;return r&&r(100),{text:E?C.text:k.text,confidence:E?A:k.confidence,extractedData:E?C.extractedData:k.extractedData,regions:b,regionBasedText:C.text,regionBasedConfidence:A,regionBasedExtractedData:C.extractedData}}mergeRegionResults(t){const e=t.sort((i,d)=>i.region.y-d.region.y).map(i=>i.text).join(`
`),r={},s=["name","title","company","phone","email","address","website","socialMedia","fax"];for(const i of s){const d=t.filter(g=>g.extractedData[i]).map(g=>({value:g.extractedData[i],confidence:g.confidence}));d.length>0&&(d.sort((g,k)=>k.confidence-g.confidence),r[i]=d[0]?.value)}return console.log("üîÄ Merged region data:",r),{text:e,extractedData:r}}async cropImageToRegion(t,e){const r=await this.loadImageToCanvas(t);if(!r.getContext("2d"))throw new Error("Could not get canvas context");const i=r.width,d=r.height,g=Math.floor(e.x*i),k=Math.floor(e.y*d),L=Math.floor(e.width*i),b=Math.floor(e.height*d),O=document.createElement("canvas"),C=O.getContext("2d");if(!C)throw new Error("Could not get cropped canvas context");return O.width=L,O.height=b,C.drawImage(r,g,k,L,b,0,0,L,b),new Promise((A,E)=>{O.toBlob(f=>{f?A(f):E(new Error("Failed to create blob from cropped canvas"))},"image/png",.95)})}async loadImageToCanvas(t){return new Promise((e,r)=>{const s=new Image,i=URL.createObjectURL(t);s.onload=()=>{const d=document.createElement("canvas"),g=d.getContext("2d");if(!g){URL.revokeObjectURL(i),r(new Error("Could not get canvas context"));return}d.width=s.width,d.height=s.height,g.drawImage(s,0,0),URL.revokeObjectURL(i),e(d)},s.onerror=()=>{URL.revokeObjectURL(i),r(new Error("Failed to load image"))},s.src=i})}async terminate(){this.worker&&(await this.worker.terminate(),this.worker=null,this.initialized=!1,console.log("üîÑ Tesseract OCR Adapter terminated"))}}export{Rt as TesseractAdapter};
